<section>
  <h1>Add New Material</h1>
  <form [formGroup]="newMaterialForm" (ngSubmit)="submit()">
    <mat-form-field appearance="outline">
      <mat-label>Material Name</mat-label>
      <input type="text" matInput formControlName="name" />
    </mat-form-field>
    <hr />
    <button
      type="button"
      mat-flat-button
      color="primary"
      (click)="addVariant()"
    >
      Add Variant
    </button>
    <h2>Variants</h2>
    <mat-checkbox formControlName="autoCalculate" color="primary" #autoCalculate
      >Auto calculate (Calculates the ratio between the values so that you can
      update automatically)</mat-checkbox
    >
    <ng-container *ngIf="autoCalculate.checked">
      <form [formGroup]="variantForm" *ngFor="let variantForm of variants; let i = index">
        <div class="rowExtended">
          <mat-radio-button (change)="selectMasterVariant(variantTag.checked,i)" #variantTag [value]="i"></mat-radio-button>
          <mat-form-field appearance="outline">
            <mat-label>Ratio</mat-label>
            <input type="number" (change)="calculatePricingFromRatio()" matInput formControlName="ratio" />
            <mat-hint>Auto Generated</mat-hint>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Variant Name</mat-label>
            <input type="text" matInput formControlName="name" />
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Unit</mat-label>
            <mat-select
              placeholder="Select Unit"
              formControlName="unit"
              name="unit"
            >
              <mat-option *ngFor="let unit of units" [value]="unit">
                {{ unit }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Rate</mat-label>
            <input (change)="calculateRatioPricing()" type="number" matInput formControlName="rate" />
          </mat-form-field>
          <button mat-icon-button (click)="delete(i)"><mat-icon>delete</mat-icon></button>
        </div>
      </form>
    </ng-container>
    
    <ng-container *ngIf="!autoCalculate.checked">
      <form [formGroup]="variantForm" *ngFor="let variantForm of variants">
        <div class="row">
          <mat-form-field appearance="outline">
            <mat-label>Variant Name</mat-label>
            <input type="text" matInput formControlName="name" />
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Unit</mat-label>
            <mat-select
              placeholder="Select Unit"
              formControlName="unit"
              name="unit"
            >
              <mat-option *ngFor="let unit of units" [value]="unit">
                {{ unit }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Rate</mat-label>
            <input type="number" matInput formControlName="rate" />
          </mat-form-field>
          <!-- <div class="field">
            <ng-container *ngIf="!swapped.checked">
              <mat-form-field appearance="outline">
                <mat-label>Rate</mat-label>
                <input type="number" matInput #rateOnQty />
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>Quantity</mat-label>
                <input type="number" matInput #quantity />
              </mat-form-field>
            </ng-container>
            <input type="checkbox" #swapped hidden>
            <button mat-icon-button color="primary" (click)="swapped.checked = !swapped.checked"><mat-icon>swap_vert</mat-icon></button>
          </div> -->
        </div>
      </form>
    </ng-container>
    <button
      mat-flat-button
      color="primary"
      [disabled]="variants.length <= 0 || newMaterialForm.invalid"
      type="submit"
    >
      Submit
    </button>
  </form>
</section>
